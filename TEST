#include <gtest/gtest.h>
#include <fstream>
#include <sstream>
#include <iostream>
#include "proyecto.h"

// Función para eliminar archivos temporales después de cada prueba
class ArchivoTemporal {
public:
    ArchivoTemporal(const std::string& nombreArchivo) : nombreArchivo_(nombreArchivo) {}

    ~ArchivoTemporal() {
        std::remove(nombreArchivo_.c_str());
    }

private:
    std::string nombreArchivo_;
};
// Clase de prueba para redirigir la entrada estándar durante las pruebas de la función Crear_Actividad
class EntradaEstandarRedirigida {
public:
    EntradaEstandarRedirigida(const std::string& input) : antiguaEntrada_(std::cin.rdbuf()) {
        std::cin.rdbuf(inputBuffer_.rdbuf());
        inputBuffer_.str(input);
        inputBuffer_.seekg(0);
    }

    ~EntradaEstandarRedirigida() {
        std::cin.rdbuf(antiguaEntrada_);
    }

private:
    std::istringstream inputBuffer_;
    std::streambuf* antiguaEntrada_;
};
// Casos de prueba para la función Login
TEST(LoginTest, CrearUsuarioEnOrganizador) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Organizador.txt");  // Archivo temporal que se eliminará automáticamente

    // Ejecutar la función de prueba
    EXPECT_EQ(Login("nuevo_usuario", "nueva_contrasena"), 3);

    // Verificar el resultado esperado
    std::ifstream archivoResultante("Organizador.txt");
    std::string usuario, contrasena;
    archivoResultante >> usuario >> contrasena;  // Leer la primera línea
    EXPECT_EQ(usuario, "nuevo_usuario");
    EXPECT_EQ(contrasena, "nueva_contrasena");
}

TEST(LoginTest, UsuarioEnOrganizador) {
    // Configuración del entorno de prueba
    std::ofstream archivoOrganizador("Organizador.txt");
    archivoOrganizador << "usuario_existente" << std::endl;
    archivoOrganizador << "contrasena_existente" << std::endl;
    archivoOrganizador.close();

    // Ejecutar la función de prueba
    EXPECT_EQ(Login("usuario_existente", "contrasena_existente"), 3);
}

TEST(LoginTest, UsuarioEnDirectorAcademico) {
    // Configuración del entorno de prueba
    std::ofstream archivoDirector("Director Academico.txt");
    archivoDirector << "usuario_director" << " contrasena_director" << std::endl;
    archivoDirector.close();

    // Ejecutar la función de prueba
    EXPECT_EQ(Login("usuario_director", "contrasena_director"), 2);
}

TEST(LoginTest, UsuarioEnUsuarios) {
    // Configuración del entorno de prueba
    std::ofstream archivoUsuarios("Usuarios.txt");
    archivoUsuarios << "usuario_comun" << " contrasena_comun" << std::endl;
    archivoUsuarios.close();

    // Ejecutar la función de prueba
    EXPECT_EQ(Login("usuario_comun", "contrasena_comun"), 1);
}

TEST(LoginTest, UsuarioNoEncontrado) {
    // Configuración del entorno de prueba
    std::ofstream archivoOrganizador("Organizador.txt");
    archivoOrganizador.close();  // Archivo Organizador vacío

    std::ofstream archivoDirector("Director Academico.txt");
    archivoDirector.close();  // Archivo Director Academico vacío

    std::ofstream archivoUsuarios("Usuarios.txt");
    archivoUsuarios.close();  // Archivo Usuarios vacío

    // Ejecutar la función de prueba
    EXPECT_EQ(Login("usuario_inexistente", "contrasena_inexistente"), 0);
}

TEST(LoginTest, NoPuedeAbrirOrganizador) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Organizador.txt");  // Archivo temporal que se eliminará automáticamente
    std::remove("Organizador.txt");  // Simular que no se puede abrir el archivo Organizador

    // Ejecutar la función de prueba
    EXPECT_EQ(Login("usuario", "contrasena"), -1);
}
// Casos de prueba para la función Visualizar_act
TEST(VisualizarActTest, ArchivoExiste) {
    // Configuración del entorno de prueba
    std::ofstream archivo("Actividades Academicas.txt");
    archivo << "Actividad 1" << std::endl;
    archivo << "Actividad 2" << std::endl;
    archivo.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Visualizar_act();

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();
    
    // Verificar el resultado esperado
    EXPECT_EQ(output, "Actividad 1\nActividad 2\n");
}

TEST(VisualizarActTest, ArchivoNoExiste) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Actividades Academicas.txt");  // Archivo temporal que se eliminará automáticamente

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Visualizar_act();

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "El archivo 'Actividades Academicas.txt' no existe.\n");
}

TEST(VisualizarActTest, ArchivoVacio) {
    // Configuración del entorno de prueba
    std::ofstream archivo("Actividades Academicas.txt");
    archivo.close();  // Archivo vacío

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Visualizar_act();

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "");
}
// Casos de prueba para la función Inscripcion
TEST(InscripcionTest, AgregarAsistenciaExitosa) {
    // Configuración del entorno de prueba
    std::ofstream archivoEntrada("Asistencia.txt");
    archivoEntrada << "usuario1 1 2 3 " << std::endl;
    archivoEntrada << "usuario2 2 3 4 " << std::endl;
    archivoEntrada.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Inscripcion(5, "usuario1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "Asistencia agregada exitosamente.\n");

    // Verificar el contenido del archivo resultante
    std::ifstream archivoResultante("Asistencia.txt");
    std::string linea;
    std::getline(archivoResultante, linea); // Leer la primera línea
    EXPECT_EQ(linea, "usuario1 1 2 3 5 ");
}

TEST(InscripcionTest, NumeroRepetido) {
    // Configuración del entorno de prueba
    std::ofstream archivoEntrada("Asistencia.txt");
    archivoEntrada << "usuario1 1 2 3 " << std::endl;
    archivoEntrada << "usuario2 2 3 4 " << std::endl;
    archivoEntrada.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Inscripcion(2, "usuario1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "Asistencia agregada exitosamente.\n");

    // Verificar que el número repetido no se haya agregado
    std::ifstream archivoResultante("Asistencia.txt");
    std::string linea;
    std::getline(archivoResultante, linea); // Leer la primera línea
    EXPECT_EQ(linea, "usuario1 1 2 3 ");
}

// Ejemplo de caso de prueba utilizando un archivo temporal
TEST(InscripcionTest, ErrorAlEliminarArchivoExistente) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Asistencia.txt");  // Archivo temporal que se eliminará automáticamente

    // Simular error al eliminar el archivo existente
    std::remove("Asistencia.txt");

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Inscripcion(1, "usuario1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "Error al eliminar el archivo existente.\n");
}

// Casos de prueba para la función Cancelacion
TEST(CancelacionTest, EliminarNumeroExitoso) {
    // Configuración del entorno de prueba
    std::ofstream archivoEntrada("Asistencia.txt");
    archivoEntrada << "usuario1 1 2 3 " << std::endl;
    archivoEntrada << "usuario2 2 3 4 " << std::endl;
    archivoEntrada.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Cancelacion(2, "usuario1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "Número eliminado exitosamente.\n");

    // Verificar el contenido del archivo resultante
    std::ifstream archivoResultante("Asistencia.txt");
    std::string linea;
    std::getline(archivoResultante, linea); // Leer la primera línea
    EXPECT_EQ(linea, "usuario1 1 3 ");
}

TEST(CancelacionTest, NumeroInexistente) {
    // Configuración del entorno de prueba
    std::ofstream archivoEntrada("Asistencia.txt");
    archivoEntrada << "usuario1 1 2 3 " << std::endl;
    archivoEntrada << "usuario2 2 3 4 " << std::endl;
    archivoEntrada.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Cancelacion(5, "usuario1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "El usuario no fue encontrado en el archivo.\n");

    // Verificar que el archivo no haya sido modificado
    std::ifstream archivoResultante("Asistencia.txt");
    std::string contenidoOriginal;
    std::getline(archivoResultante, contenidoOriginal); // Leer la primera línea
    EXPECT_EQ(contenidoOriginal, "usuario1 1 2 3 ");
}

// Ejemplo de caso de prueba utilizando un archivo temporal
TEST(CancelacionTest, ErrorAlRenombrarArchivoTemporal) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Asistencia.txt");  // Archivo temporal que se eliminará automáticamente

    // Simular error al renombrar el archivo temporal
    std::remove("Asistencia_temp.txt");

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Cancelacion(1, "usuario1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "Error al renombrar el archivo temporal.\n");
}
// Casos de prueba para la función Ver_asistencia
TEST(VerAsistenciaTest, ArchivoExiste) {
    // Configuración del entorno de prueba
    std::ofstream archivoEntrada("Asistencia.txt");
    archivoEntrada << "usuario1 1 2 3 " << std::endl;
    archivoEntrada << "usuario2 2 3 4 " << std::endl;
    archivoEntrada.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Ver_asistencia();

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "usuario1 1 2 3 \nusuario2 2 3 4 \n");
}

TEST(VerAsistenciaTest, ArchivoNoExiste) {
    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Ver_asistencia();

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "El archivo 'Asistencia.txt' no existe.\n");
}

// Ejemplo de caso de prueba utilizando un archivo temporal
TEST(VerAsistenciaTest, ErrorAlAbrirArchivo) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Asistencia.txt");  // Archivo temporal que se eliminará automáticamente

    // Simular error al abrir el archivo
    std::remove("Asistencia.txt");

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Ver_asistencia();

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "El archivo 'Asistencia.txt' no existe.\n");
}
// Casos de prueba para la función Eliminar_usuario_registrado
TEST(EliminarUsuarioTest, UsuarioExistente) {
    // Configuración del entorno de prueba
    std::ofstream archivoEntrada("Usuarios.txt");
    archivoEntrada << "usuario1 contraseña1" << std::endl;
    archivoEntrada << "usuario2 contraseña2" << std::endl;
    archivoEntrada.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Eliminar_usuario_registrado("usuario1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "Usuario eliminado exitosamente.\n");

    // Verificar el contenido del archivo resultante
    std::ifstream archivoResultante("Usuarios.txt");
    std::string linea;
    std::getline(archivoResultante, linea); // Leer la primera línea
    EXPECT_EQ(linea, "usuario2 contraseña2");
}

TEST(EliminarUsuarioTest, UsuarioInexistente) {
    // Configuración del entorno de prueba
    std::ofstream archivoEntrada("Usuarios.txt");
    archivoEntrada << "usuario1 contraseña1" << std::endl;
    archivoEntrada << "usuario2 contraseña2" << std::endl;
    archivoEntrada.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Eliminar_usuario_registrado("usuario3");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "El usuario no fue encontrado en el archivo.\n");

    // Verificar que el archivo no haya sido modificado
    std::ifstream archivoResultante("Usuarios.txt");
    std::string contenidoOriginal;
    std::getline(archivoResultante, contenidoOriginal); // Leer la primera línea
    EXPECT_EQ(contenidoOriginal, "usuario1 contraseña1");
}

// Ejemplo de caso de prueba utilizando un archivo temporal
TEST(EliminarUsuarioTest, ErrorAlRenombrarArchivoTemporal) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Usuarios.txt");  // Archivo temporal que se eliminará automáticamente

    // Simular error al renombrar el archivo temporal
    std::remove("Usuarios_temp.txt");

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Eliminar_usuario_registrado("usuario1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "Error al renombrar el archivo temporal.\n");
}
// Casos de prueba para la función Crear_actividad
TEST(CrearActividadTest, AgregarActividadCorrectamente) {
    // Configuración del entorno de prueba
    EntradaEstandarRedirigida input("1\nTema1\nUbicacion1\nFecha1\nAforo1\nAsistentes1\n2\n10.5\nMaterial1\n");

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Crear_actividad();

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "La actividad se ha agregado al archivo 'Actividades Academicas.txt'.\n");

    // Verificar el contenido del archivo resultante
    std::ifstream archivoResultante("Actividades Academicas.txt");
    std::string linea;
    std::getline(archivoResultante, linea); // Leer la primera línea
    EXPECT_EQ(linea, "Número de actividad: 1");
}

// Ejemplo de caso de prueba utilizando un archivo temporal
TEST(CrearActividadTest, ErrorAlAbrirArchivo) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Actividades Academicas.txt");  // Archivo temporal que se eliminará automáticamente

    // Simular error al abrir el archivo
    std::remove("Actividades Academicas.txt");

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Crear_actividad();

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "No se pudo abrir el archivo 'Actividades Academicas.txt'.\n");
}
// Casos de prueba para la función Eliminar_act
TEST(EliminarActTest, EliminarActividadCorrectamente) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Actividades Academicas.txt");  // Archivo temporal que se eliminará automáticamente

    // Crear un archivo de ejemplo con una actividad
    std::ofstream archivoEjemplo("Actividades Academicas.txt");
    archivoEjemplo << "Número de actividad: 1" << std::endl;
    archivoEjemplo << "Otra línea" << std::endl;
    archivoEjemplo << "Otra línea" << std::endl;
    archivoEjemplo << "Otra línea" << std::endl;
    archivoEjemplo << "Otra línea" << std::endl;
    archivoEjemplo << "Otra línea" << std::endl;
    archivoEjemplo << "Otra línea" << std::endl;
    archivoEjemplo << "Otra línea" << std::endl;
    archivoEjemplo << "Otra línea" << std::endl;
    archivoEjemplo << "Otra línea" << std::endl;
    archivoEjemplo.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Eliminar_act(1);

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "La actividad ha sido eliminada correctamente.\n");

    // Verificar que el archivo resultante no contiene la actividad eliminada
    std::ifstream archivoResultante("Actividades Academicas.txt");
    std::vector<std::string> lineas;
    std::string linea;
    while (std::getline(archivoResultante, linea)) {
        lineas.push_back(linea);
    }
    EXPECT_EQ(lineas.size(), 1);  // Debería haber una sola línea restante
    EXPECT_EQ(lineas[0], "Número de actividad: 1");
}

// Caso de prueba para la función Eliminar_act cuando la actividad no se encuentra
TEST(EliminarActTest, ActividadNoEncontrada) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Actividades Academicas.txt");  // Archivo temporal que se eliminará automáticamente

    // Crear un archivo de ejemplo sin la actividad a eliminar
    std::ofstream archivoEjemplo("Actividades Academicas.txt");
    archivoEjemplo << "Número de actividad: 2" << std::endl;
    archivoEjemplo.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Eliminar_act(1);

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "La actividad no fue encontrada.\n");

    // Verificar que el archivo no ha sido modificado
    std::ifstream archivoResultante("Actividades Academicas.txt");
    std::vector<std::string> lineas;
    std::string linea;
    while (std::getline(archivoResultante, linea)) {
        lineas.push_back(linea);
    }
    EXPECT_EQ(lineas.size(), 1);  // Debería haber una sola línea
    EXPECT_EQ(lineas[0], "Número de actividad: 2");
}

// Casos de prueba para la función Crear_usuario
TEST(CrearUsuarioTest, AgregarUsuarioCorrectamente) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Usuarios.txt");  // Archivo temporal que se eliminará automáticamente

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Crear_usuario("Usuario1", "Contraseña1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "Las credenciales han sido agregadas al archivo 'Usuarios.txt'.\n");

    // Verificar que el archivo resultante contiene el usuario creado
    std::ifstream archivoResultante("Usuarios.txt");
    std::vector<std::string> lineas;
    std::string linea;
    while (std::getline(archivoResultante, linea)) {
        lineas.push_back(linea);
    }
    EXPECT_EQ(lineas.size(), 2);  // Debería haber dos líneas
    EXPECT_EQ(lineas[0], "Usuario1");
    EXPECT_EQ(lineas[1], "Contraseña1");
}
// Caso de prueba para la función Designar_director_academico
TEST(DesignarDirectorTest, DesignarDirectorAcademicoCorrectamente) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Director Academico.txt");  // Archivo temporal que se eliminará automáticamente

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Designar_director_academico("Director1", "Contraseña1");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "El archivo 'Director Academico.txt' ha sido creado o sustituido con las nuevas credenciales.\n");

    // Verificar que el archivo resultante contiene las credenciales del director académico
    std::ifstream archivoResultante("Director Academico.txt");
    std::vector<std::string> lineas;
    std::string linea;
    while (std::getline(archivoResultante, linea)) {
        lineas.push_back(linea);
    }
    EXPECT_EQ(lineas.size(), 2);  // Debería haber dos líneas
    EXPECT_EQ(lineas[0], "Director1");
    EXPECT_EQ(lineas[1], "Contraseña1");
}

// Caso de prueba para la función Designar_director_academico cuando no se puede crear el archivo
TEST(DesignarDirectorTest, NoSePuedeCrearArchivo) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Director Academico.txt");  // Archivo temporal que se eliminará automáticamente

    // Crear un archivo de ejemplo con contenido
    std::ofstream archivoEjemplo("Director Academico.txt");
    archivoEjemplo << "UsuarioExistente" << std::endl;
    archivoEjemplo << "ContraseñaExistente" << std::endl;
    archivoEjemplo.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Designar_director_academico("Director2", "Contraseña2");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "No se pudo crear el archivo 'Director Academico.txt'.\n");

    // Verificar que el archivo no ha sido modificado
    std::ifstream archivoResultante("Director Academico.txt");
    std::vector<std::string> lineas;
    std::string linea;
    while (std::getline(archivoResultante, linea)) {
        lineas.push_back(linea);
    }
    EXPECT_EQ(lineas.size(), 2);  // Debería haber dos líneas
    EXPECT_EQ(lineas[0], "UsuarioExistente");
    EXPECT_EQ(lineas[1], "ContraseñaExistente");
}
// Caso de prueba para la función Crear_mail
TEST(CrearMailTest, CrearMailExitoso) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Mails.txt");  // Archivo temporal que se eliminará automáticamente

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Crear_mail(1, "Este es un mensaje de prueba.");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "1\nEste es un mensaje de prueba.\n----------------------------------------\n");

    // Verificar que el archivo resultante contiene el nuevo correo
    std::ifstream archivoResultante("Mails.txt");
    std::vector<std::string> lineas;
    std::string linea;
    while (std::getline(archivoResultante, linea)) {
        lineas.push_back(linea);
    }
    EXPECT_EQ(lineas.size(), 3);  // Debería haber tres líneas
    EXPECT_EQ(lineas[0], "1");
    EXPECT_EQ(lineas[1], "Este es un mensaje de prueba.");
    EXPECT_EQ(lineas[2], "----------------------------------------");
}

// Caso de prueba para la función Crear_mail cuando no se puede abrir o crear el archivo
TEST(CrearMailTest, NoSePuedeAbrirOCrearArchivo) {
    // Configuración del entorno de prueba
    ArchivoTemporal archivoTemp("Mails.txt");  // Archivo temporal que se eliminará automáticamente

    // Crear un archivo de ejemplo con contenido
    std::ofstream archivoEjemplo("Mails.txt");
    archivoEjemplo << "1" << std::endl;
    archivoEjemplo << "MensajeExistente" << std::endl;
    archivoEjemplo << "----------------------------------------" << std::endl;
    archivoEjemplo.close();

    // Redirigir la salida estándar para capturarla
    testing::internal::CaptureStdout();

    // Ejecutar la función de prueba
    Crear_mail(2, "Otro mensaje de prueba.");

    // Restaurar la salida estándar
    std::string output = testing::internal::GetCapturedStdout();

    // Verificar el resultado esperado
    EXPECT_EQ(output, "Error al abrir o crear el archivo 'Mails.txt'.\n");

    // Verificar que el archivo no ha sido modificado
    std::ifstream archivoResultante("Mails.txt");
    std::vector<std::string> lineas;
    std::string linea;
    while (std::getline(archivoResultante, linea)) {
        lineas.push_back(linea);
    }
    EXPECT_EQ(lineas.size(), 3);  // Debería haber tres líneas
    EXPECT_EQ(lineas[0], "1");
    EXPECT_EQ(lineas[1], "MensajeExistente");
    EXPECT_EQ(lineas[2], "----------------------------------------");
}
int main(int argc, char** argv) { // Ejecutar todas los TEST
    ::testing::InitGoogleTest(&argc, argv);
    return RUN_ALL_TESTS();
